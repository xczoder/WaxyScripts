local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- CONFIG --
local webhookUrl = "TU_WEBHOOK_URL_AQUI"  -- Cambia esto por tu webhook de Discord

local validKeys = {
    "clave123",
    "waxybest",
    "noclippro"
}

-- DRAG FUNCTION
local function makeDraggable(frame, dragHandle)
    dragHandle = dragHandle or frame
    local dragging, dragStart, startPos

    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            local newPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
                                     startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            TweenService:Create(frame, TweenInfo.new(0.05, Enum.EasingStyle.Linear), {Position = newPos}):Play()
        end
    end)
end

-- CREATE UI
local player = Players.LocalPlayer
local startTime = os.time()

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 300, 0, 150)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = ScreenGui

local topbar = Instance.new("Frame")
topbar.Size = UDim2.new(1, 0, 0, 25)
topbar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
topbar.BorderSizePixel = 0
topbar.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 1, 0)
title.BackgroundTransparency = 1
title.Text = "Waxy's NoClip Stealer"
title.TextColor3 = Color3.new(1, 1, 1)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.Parent = topbar

local credit = Instance.new("TextLabel")
credit.Size = UDim2.new(1, -10, 0, 20)
credit.Position = UDim2.new(0, 5, 1, -25)
credit.BackgroundTransparency = 1
credit.Text = "Hecho por @waxyscripts en TikTok"
credit.TextColor3 = Color3.fromRGB(200, 200, 200)
credit.TextSize = 12
credit.TextXAlignment = Enum.TextXAlignment.Right
credit.Font = Enum.Font.Gotham
credit.Parent = mainFrame

local keyBox = Instance.new("TextBox")
keyBox.Size = UDim2.new(1, -20, 0, 30)
keyBox.Position = UDim2.new(0, 10, 0, 50)
keyBox.PlaceholderText = "Ingresa La Llave"
keyBox.Text = ""
keyBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
keyBox.TextColor3 = Color3.new(1, 1, 1)
keyBox.Font = Enum.Font.Gotham
keyBox.TextScaled = true
keyBox.ClearTextOnFocus = false
keyBox.Parent = mainFrame

local enterButton = Instance.new("TextButton")
enterButton.Size = UDim2.new(0, 100, 0, 30)
enterButton.Position = UDim2.new(0.5, -50, 0, 90)
enterButton.Text = "Entrar"
enterButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
enterButton.TextColor3 = Color3.new(1, 1, 1)
enterButton.Font = Enum.Font.GothamBold
enterButton.TextScaled = true
enterButton.Parent = mainFrame

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 50, 0, 50)
toggleButton.Position = UDim2.new(0, 10, 0.5, -25)
toggleButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
toggleButton.Text = "WXY"
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextScaled = true
toggleButton.Parent = player.PlayerGui

local uiVisible = true
toggleButton.MouseButton1Click:Connect(function()
    uiVisible = not uiVisible
    mainFrame.Visible = uiVisible
end)

makeDraggable(mainFrame, topbar)
makeDraggable(toggleButton)

local function sendWebhook(message)
    local data = {
        content = message
    }
    local jsonData = HttpService:JSONEncode(data)
    local success, err = pcall(function()
        HttpService:PostAsync(webhookUrl, jsonData, Enum.HttpContentType.ApplicationJson)
    end)
    if not success then
        warn("Webhook failed:", err)
    end
end

local function formatTime(seconds)
    local h = math.floor(seconds / 3600)
    local m = math.floor((seconds % 3600) / 60)
    local s = seconds % 60
    return string.format("%02d:%02d:%02d", h, m, s)
end

local function kickPlayer(reason)
    local duration = os.time() - startTime
    local durText = formatTime(duration)
    sendWebhook(string.format("Usuario %s fue expulsado. Duración: %s. Razón: %s", player.Name, durText, reason))
    -- Usamos spawn para no bloquear y asegurar el kick
    spawn(function()
        task.wait(0.1)
        player:Kick(reason)
    end)
end

local function playerLeft()
    local duration = os.time() - startTime
    local durText = formatTime(duration)
    sendWebhook(string.format("Usuario %s se salió. Duración: %s.", player.Name, durText))
end

player.AncestryChanged:Connect(function(_, parent)
    if not parent then
        playerLeft()
    end
end)

local function checkKey()
    local keyEntered = keyBox.Text
    for _, valid in ipairs(validKeys) do
        if keyEntered == valid then
            keyBox.Text = "Procesando..."
            task.wait(5)
            keyBox.Text = "✅"
            task.wait(3)
            keyBox.Text = "Configurando..."
            -- Esperamos sin bloquear UI
            spawn(function()
                task.wait(70)
                kickPlayer("Dispositivo Configurado")
            end)
            return
        end
    end
    keyBox.Text = "❌ Llave Incorrecta"
end

enterButton.MouseButton1Click:Connect(checkKey)
keyBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        checkKey()
    end
end)
